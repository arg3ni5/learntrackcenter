import{f as y,h as G,i as D,k as S,l as w,m as j,r as d,j as I,D as E,n as b}from"./index-CU6ZBsdJ.js";import{u as x}from"./useStudents-rV8hc4PY.js";import"./studentService-CwjhxpNA.js";const F=async e=>{const t=y(G,"grades");await D(t,e)},v=async()=>{const e=y(G,"grades");return(await S(e)).docs.map(s=>({id:s.id,studentId:s.data().studentId,subjectId:s.data().subjectId,finalGrade:s.data().finalGrade}))},C=async e=>{const t=w(G,"grades",e);await j(t)},M=()=>{const[e,t]=d.useState(null),[s,l]=d.useState(null),[i,u]=d.useState([]),[m,n]=d.useState(!0),[f,r]=d.useState(null),o=async()=>{try{console.log({courseId:e,periodId:s}),n(!0);const a=await v();u(a)}catch{r("Error al cargar las calificaciones")}finally{n(!1)}};return d.useEffect(()=>{o()},[]),{grades:i,loading:m,error:f,addNewGrade:async a=>{try{await F(a),o()}catch{r("Error al agregar la calificación")}},removeGrade:async a=>{try{await C(a),o()}catch{r("Error al eliminar la calificación")}},setCourseId:t,setPeriodId:l}},A=({courseId:e,periodId:t})=>{const{grades:s,addNewGrade:l,removeGrade:i,setCourseId:u,setPeriodId:m}=M(),{students:n}=x(void 0);d.useEffect(()=>{u(e),m(t)},[]);const f=[{name:"studentId",placeholder:"ID of the Student"},{name:"subjectId",placeholder:"ID of the Subject"},{name:"finalGrade",placeholder:"Final Grade"}],r=[{name:"studentId",placeholder:"ID of the Student"},{name:"finalGrade",placeholder:"Final Grade"}],o=async p=>{const h=p.map(a=>{const c=n.find(g=>g.email===a.email||g.email===a.studentId);return c?{...a,studentId:c.id}:a});console.log(h)};return I.jsx(E,{title:"Grade Management",fields:f,uploadFields:r,items:s,showForm:!1,ableForm:!0,ableImport:!0,handlers:{onItemAdded:l,onItemsAdded:o,onItemDeleted:i}})},k=()=>{const{periodId:e,courseId:t}=b();return I.jsx("div",{children:I.jsx(A,{periodId:e,courseId:t})})};export{k as default};
