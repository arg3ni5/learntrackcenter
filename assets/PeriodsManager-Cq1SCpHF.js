import{u as L,b as R,j as e,k as M,e as P,l as V,m as U,f as $}from"./index-g1SReERP.js";import{r as d,h as G}from"./vendor-react-CrVlFZLu.js";import{u as A,C as _}from"./Card-CSivsItZ.js";import{f as O}from"./teacherService-rIMiBxmN.js";import{f as B,a as z,d as H,u as J,b as W}from"./periodCourseService-CGSWCgaZ.js";import{C as I}from"./CourseAssignmentsManager-Cahn1cf0.js";import{S as q,D as k}from"./DataManagementModule-3FyRWLSI.js";import{C as w}from"./vendor-ui-Cz82L-V6.js";const K=10*60*1e3,Q=r=>{const[m,f]=d.useState([]),[n,l]=d.useState(!0),[h,v]=A("availableTeachers",[]),[c,u]=A("availableCourses",[]),{showNotification:t}=L(),{setIsLoading:x}=R();d.useEffect(()=>{x(n)},[n,x]);const g=async()=>{if(m.length===0)try{l(!0);const s=(await B(r)).map(i=>{const p=h.find(N=>N.id===i.teacherId);return{...i,teacherName:p?p.name:"Unassigned Teacher"}});f(s)}catch(a){console.error("Error loading period courses:",a),t("Error loading period courses","error")}finally{l(!1)}},b={teachers:async(a=!1)=>{try{if(!a&&h.length>0){console.log("Teachers data already loaded. Skipping fetch.");return}a&&l(!0);const s=await O();v(s),localStorage.setItem("availableTeachers",JSON.stringify(s)),console.log("Teachers data updated.")}catch(s){console.error("Error loading teachers:",s),t("Error loading teachers","error")}finally{a&&l(!1)}},courses:async(a=!1)=>{try{if(!a&&c.length>0){console.log("Available Courses data already loaded. Skipping fetch.");return}a&&l(!0);const s=await W();u(s),localStorage.setItem("availableCourses",JSON.stringify(s)),console.log("Available Courses data updated.")}catch(s){console.error("Error loading available courses:",s),t("Error loading available courses","error")}finally{a&&l(!1)}}},o=async(a,s=!1)=>{let i=["teachers","courses"];typeof a=="boolean"?s=a:Array.isArray(a)&&(i=a);const p=i.map(N=>b[N](s));p.length>0?(await Promise.all(p),console.log("Selected global data loaded.")):console.log("No valid data type selected for loading.")};return d.useEffect(()=>{r&&g()},[r]),d.useEffect(()=>{o();const a=setInterval(()=>o(["courses"],!0),K);return()=>clearInterval(a)},[]),{courses:m,availableCourses:c,availableTeachers:h,loading:n,handleAddCourse:async a=>{try{if(m.some(s=>s.courseId===a.courseId)){t("Course already added","error");return}l(!0),await z(r,a),g()}catch{t("Error adding course","error")}finally{l(!1)}},handleDeleteCourse:async a=>{try{if(!a)return;l(!0),await H(r,a),g()}catch(s){t("Error deleting course","error"),console.error("Error deleting course:",s)}finally{l(!1)}},handleUpdateCourse:async(a,s)=>{try{if(!r)return;l(!0),await J(r,a,s),g()}catch(i){t("Error updating course","error"),console.error("Error updating course:",i)}finally{l(!1)}},loadGlobalData:()=>o(!0),loadAvailableCourses:()=>o(["courses"],!0),loadAvailableTeachers:()=>o(["teachers"],!0)}},X=[{name:"description",placeholder:"description"},{name:"duration",placeholder:"duration"},{name:"hours",placeholder:"hours"},{name:"status",placeholder:"status"},{name:"assignmentsIds",placeholder:"assignments",type:"array"},{name:"enrolledStudents",placeholder:"Enrolled Students",type:"array"},{name:"teacherName",placeholder:"teacherName"}],D=({children:r,className:m,childrenVisible:f,course:n,teachers:l,setSelectedTeacher:h,viewLink:v,handlers:c})=>{var j;const[u,t]=d.useState(f),x=d.useRef(null),g=d.useRef(null),{onDelete:y,onItemAdded:S,onItemUpdated:b}=c,o=()=>{t(!u)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:m,children:[!n.teacherId&&e.jsx(e.Fragment,{children:e.jsx(q,{label:"Teacher",options:l.map(C=>({value:C.id,label:C.name})),value:"",onChange:C=>h(C.value),placeholder:"Select Teacher"},"teacherId")}),e.jsx(w,{in:u,timeout:500,classNames:"fade",unmountOnExit:!0,nodeRef:x,children:e.jsx("div",{ref:C=>x.current=C,className:"fade-container",children:r})}),e.jsx(w,{in:!u,timeout:500,classNames:{enter:"animate__animated animate__bounceInUp"},nodeRef:g,children:e.jsx("div",{ref:g,children:e.jsx(_,{titleName:"name",fields:X,data:n,viewLink:v,handlers:{onDelete:y,onItemAdded:S,onItemUpdated:b},ableDelete:n.assignmentsIds.length===0&&(((j=n.enrolledStudents)==null?void 0:j.length)??0)===0,customButtons:[{label:u?"Hide Assignments":"Assignments",icon:e.jsx(M,{}),onClick:o,className:"save-button",ariaLabel:"Toggle Details Button"}]})})})]})})},T=[{name:"name",placeholder:"name",size:10,visible:!0},{name:"description",placeholder:"description",visible:!0},{name:"teacherName",placeholder:"teacher",visible:!1}],Y=({type:r,courses:m,setSelectedCourseId:f,loading:n,load:l,assign:h})=>{const v=t=>{t&&f&&f(t.id??null)},[c,u]=d.useState(T);return d.useEffect(()=>{u(r==="assign"?T.map(t=>t.name==="teacherName"?{...t,visible:!0}:t):T)},[r]),e.jsx(k,{className:"p-0",alias:`${r}Courses`.toUpperCase(),fields:c,items:m,handlers:{onSelect:v,onReload:l,onAssign:h},ableForm:!1,showForm:!1,loading:n})},Z=[{name:"name",placeholder:"name",size:10},{name:"description",placeholder:"description"},{name:"teacherName",placeholder:"teacher"}],ee=({periodId:r,courses:m,teachers:f,loading:n,load:l,assign:h,handlers:v})=>{const[c,u]=d.useState(null),[,t]=d.useState(null);return e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"p-0",alias:"assignCourses",fields:Z,items:m,handlers:{onSelect:u,onReload:l,onAssign:h},ableForm:!1,showForm:!1,loading:n}),c&&e.jsx(D,{course:c,teachers:f,handlers:v,setSelectedTeacher:t,viewLink:`/period/${r}/course/${c.id}`,children:c.id&&r&&e.jsx(I,{course:c})})]})},ce=({periodId:r})=>{const m=G(),{loading:f,courses:n,availableCourses:l,availableTeachers:h,handleAddCourse:v,handleDeleteCourse:c,handleUpdateCourse:u,loadAvailableCourses:t}=Q(r),[x,g]=d.useState(null),[y,S]=d.useState(null),[b]=A("selectPeriod",null),[o,j]=A("PeriodsManager.viewMode","table"),C=async s=>{if(y){const{id:i,...p}=s,N={...p,teacherId:y};await u(i,N),S(null)}},E=async()=>{if(!x)return;const s=l.find(F=>F.id===x);if(!s)return;const{id:i,...p}=s,N={...p,periodId:r,courseId:i,status:"Not Started",assignmentsIds:[],enrolledStudents:[]};await v(N),g(null)},a={onDelete:c,onItemUpdated:C};return e.jsxs("div",{className:"periods-manager",children:[e.jsxs("div",{className:"container px-0",style:{paddingBottom:30},children:[e.jsx("h1",{children:b==null?void 0:b.name}),e.jsxs("button",{onClick:()=>m(-1),children:[e.jsx(P,{})," Go Back"]})]}),e.jsxs("div",{className:"container row p-0",children:[e.jsxs("div",{className:"view-toggle",children:[e.jsxs("button",{onClick:()=>j("cards"),className:o==="cards"?"active":"",children:[e.jsx(V,{})," ",e.jsx("span",{className:"d-none d-md-block-over",children:"Cards View"})]}),e.jsxs("button",{onClick:()=>j("table"),className:o==="table"?"active":"",children:[e.jsx(U,{})," ",e.jsx("span",{className:"d-none d-md-block-over",children:"Table View"})]})]}),e.jsx("div",{className:"view-toggle",children:(b==null?void 0:b.status)!=1&&e.jsxs("button",{onClick:()=>j("assign"),className:o==="assign"?"active":"",children:[e.jsx($,{})," ",e.jsx("span",{className:"d-none d-md-block-over",children:"Assign Courses"})]})})]}),e.jsx("h1",{className:"title bt",children:o==="assign"?"COURSES TO ASSIGN":"ASSIGNED COURSES"}),o==="assign"&&r&&e.jsxs("div",{className:"item m-0 p-0",children:[e.jsx(Y,{type:"available",courses:l.filter(s=>!n.some(i=>i.courseId===s.id)),setSelectedCourseId:g,assign:E,loading:f,load:t}),l.length===0&&e.jsx("div",{className:"empty",children:"No courses available for this period"}),l.filter(s=>!n.some(i=>i.courseId===s.id)).length===0&&e.jsx("div",{className:"empty",children:"All available courses have already been assigned to this period."})]}),o==="table"&&e.jsx("div",{className:"item m-0 p-0",children:e.jsx(ee,{type:"assign",courses:n,loading:f,teachers:h,periodId:r,handlers:a})}),o==="cards"&&e.jsx("div",{className:"container-flex",children:n.map(s=>e.jsx(D,{className:"item",course:s,teachers:h,handlers:a,setSelectedTeacher:S,childrenVisible:!1,viewLink:`/period/${r}/course/${s.id}`,children:s.id&&r&&e.jsx(I,{course:s})},s.id))})]})};export{ce as P};
