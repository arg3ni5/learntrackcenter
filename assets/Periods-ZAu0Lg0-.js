import{u as D,b as E,j as c}from"./index-g1SReERP.js";import{r as l,h as y}from"./vendor-react-CrVlFZLu.js";import{u as w}from"./Card-CSivsItZ.js";import{D as x}from"./DataManagementModule-3FyRWLSI.js";import{f as v,a as I,d as N,u as b}from"./periodService-CU21sGfe.js";import"./vendor-firebase-DPqF2cx7.js";import"./vendor-ui-Cz82L-V6.js";import"./vendor-utils-CMv371St.js";var g=(t=>(t[t.Created=0]="Created",t[t.Finished=1]="Finished",t[t.Active=2]="Active",t[t.Upcoming=3]="Upcoming",t))(g||{});const j=()=>{const[t,a]=l.useState([]),[d,m]=l.useState(!0),{showNotification:p,showError:r}=D(),i=async()=>{try{m(!0);const e=await v();return a(e),e}catch{return r("Error fetching periods"),[]}finally{m(!1)}};return l.useEffect(()=>{i()},[]),{periods:t,loadPeriods:i,loading:d,handleAddPeriod:async e=>{try{const o=await I(e);o.id?a(s=>[...s,o]):r("Error adding period, no ID returned")}catch{r("Error adding period")}},handleDeletePeriod:async e=>{const o=t.find(s=>s.id===e);if(!o){r("Period does not exist in the local state");return}if(o&&o.coursesIds&&o.coursesIds.length>0){r("Cannot delete period: it has associated courses.");return}try{await N(e)&&(p("Item deleted","success"),a(n=>n.filter(P=>P.id!==e)))}catch{r("Error deleting period")}},handleUpdatePeriod:async(e,o)=>{try{await b(e,o),a(s=>s.map(n=>n.id===e?{...n,...o}:n))}catch{r("Error updating period")}}}},A=()=>{const{setIsLoading:t}=E(),{periods:a,loading:d,handleAddPeriod:m,handleDeletePeriod:p,handleUpdatePeriod:r}=j(),[,i]=w("selectPeriod",null),u=y(),h=l.useMemo(()=>Object.entries(g).filter(([,e])=>!isNaN(Number(e))).map(([e,o])=>({value:o.toString(),label:e})),[]),f=e=>{u(`/period/${e.id}/courses`),i(e)};return l.useEffect(()=>{t(d)},[d,t]),c.jsx(c.Fragment,{children:c.jsx(x,{title:"Manage Academic Periods",fields:[{name:"code",placeholder:"Code of Period",label:"Code",size:10},{name:"name",placeholder:"Name of Period",label:"Name",size:20},{name:"startDate",placeholder:"Start Date",size:10},{name:"endDate",placeholder:"End Date",size:10},{name:"status",placeholder:"Status",size:8,type:"select",options:h}],items:a,handlers:{onItemAdded:m,onItemDeleted:p,onItemUpdated:r,onSelect:i,onView:f},initialFormData:null,viewLinks:[{label:"Courses",format:"/period/:id/courses"}],loading:d,showForm:!1})})},k=()=>c.jsx("div",{children:c.jsx(A,{})});export{k as default};
